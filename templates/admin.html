<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="top-buttons">
        <a href="{{ url_for('home') }}" class="top-btn">â¬… Back to Upload</a>
        <button id="darkModeToggle" class="top-btn">DarkðŸŒ™Mode</button>
    </div>

    <h1>Admin Dashboard</h1>

    <div class="search-bar" style="text-align: center; margin-bottom: 20px;">
        <input type="text" placeholder="Search by filename..." class="search-input">
        <select class="search-select">
            <option value="all" selected>All Categories</option>
            <option value="Resume">Resume</option>
            <option value="Medical">Medical</option>
            <option value="Invoice">Invoice</option>
            <option value="Others">Others</option>
        </select>
    </div>

    <div class="chart-container" style="max-width: 500px; margin: 0 auto;">
        <canvas id="docChart"></canvas>
    </div>

    {% if documents %}
    <div class="table-wrapper">
        <table>
            <thead>
                <tr>
                    <th>Filename</th>
                    <th>Type</th>
                    <th>Uploaded</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for doc in documents %}
                <tr>
                    <td data-label="Filename">{{ doc.filename }}</td>
                    <td data-label="Type">{{ doc.doc_type }}</td>
                    <td data-label="Uploaded">{{ doc.upload_time.strftime('%Y-%m-%d %H:%M:%S') }}</td>
                    <td data-label="Actions">
                        <a href="/static/{{ doc.file_path }}" target="_blank" class="button-link">View</a>
                        <a href="/static/{{ doc.file_path }}" download class="button-link">Download</a>
                        <button class="view-btn" onclick="toggleText('{{ doc.id }}')">View Text</button>
                        <form action="{{ url_for('delete_document', doc_id=doc.id) }}" method="POST" style="display:inline;">
                            <button type="submit" class="delete-btn">ðŸ—‘</button>
                        </form>
                        <div id="text-{{ doc.id }}" class="extracted-text">
                            <pre>{{ doc.extracted_text }}</pre>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
        <p class="no-data">No documents found.</p>
    {% endif %}

    <script>
        function toggleText(id) {
            const div = document.getElementById('text-' + id);
            div.style.display = (div.style.display === 'none' || div.style.display === '') ? 'block' : 'none';
        }

        const ctx = document.getElementById('docChart').getContext('2d');
        new Chart(ctx, {
            type: 'pie',
            data: {
                labels: ['Resume', 'Medical', 'Invoice', 'Others'],
                datasets: [{
                    data: [
                        {{ doc_counts.get('Resume', 0) }},
                        {{ doc_counts.get('Medical', 0) }},
                        {{ doc_counts.get('Invoice', 0) }},
                        {{ doc_counts.get('Others', 0) }}
                    ],
                    backgroundColor: [
                        '#AA336A', '#DF3C5F', '#224193', '#6F9BD1'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { position: 'bottom' }
                }
            }
        });
    </script>
    <script src="{{ url_for('static', filename='darkmode.js') }}"></script>
    <script src="{{ url_for('static', filename='search.js') }}"></script>
</body>
</html>
