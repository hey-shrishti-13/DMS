<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Uploaded Documents</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

    <div class="top-buttons">
        <a href="{{ url_for('home') }}" class="top-btn">â¬… Back to Upload</a>
        <button id="darkModeToggle" class="top-btn">DarkðŸŒ™Mode</button>
    </div>

    <h1>Uploaded Documents</h1>

    <div class="search-bar" style="text-align: center; margin-bottom: 20px;">
        <input type="text" placeholder="Search by filename..." class="search-input">
        <select class="search-select">
            <option value="all" selected>All Categories</option>
            <option value="Resume">Resume</option>
            <option value="Medical">Medical</option>
            <option value="Invoice">Invoice</option>
            <option value="Others">Others</option>
        </select>
    </div>

    {% if documents %}
    <div class="table-wrapper">
        <table>
            <thead>
                <tr>
                    <th>Filename</th>
                    <th>Document Type</th>
                    <th>Upload Time</th>
                    <th>File</th>
                    <th>Extracted Text</th>
                    <th>Delete</th>
                </tr>
            </thead>
            <tbody>
                {% for doc in documents %}
                <tr>
                    <td data-label="Filename">{{ doc.filename }}</td>
                    <td data-label="Document Type">{{ doc.doc_type }}</td>
                    <td data-label="Uploaded">{{ doc.upload_time.strftime("%Y-%m-%d %H:%M:%S") }}</td>
                    <td data-label="File">
                        <a href="/static/{{ doc.file_path }}" target="_blank" class="button-link">View</a>
                        <a href="/static/{{ doc.file_path }}" download class="button-link">Download</a>
                    </td>
                    <td>
                        <div class="extracted-wrapper">
                            <button class="view-btn" onclick="toggleText('{{ doc.id }}')">View Text</button>
                            <div id="text-{{ doc.id }}" class="extracted-text">
                                <pre>{{ doc.extracted_text | e }}</pre>
                            </div>
                        </div>
                    </td>
                    <td data-label="Delete">
                        <form action="{{ url_for('delete_document', doc_id=doc.id) }}" method="POST" onsubmit="return confirm('Are you sure you want to delete this document?');">
                            <button type="submit" class="delete-btn">ðŸ—‘</button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
        <p class="no-data">No documents match your search.</p>
    {% endif %}

    <script>
        function toggleText(id) {
            const div = document.getElementById('text-' + id);
            div.style.display = (div.style.display === 'none' || div.style.display === '') ? 'block' : 'none';
        }
    </script>
    <script src="{{ url_for('static', filename='darkmode.js') }}"></script>
    <script src="{{ url_for('static', filename='search.js') }}"></script>
</body>
</html>
